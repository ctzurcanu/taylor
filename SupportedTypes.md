# dTypes

## Base

Type id rules:

```
11000000 - u
11000001 - u8
11000002 - u16
11000004 - u32

12000000 - i

byte
22000000 - byte
22000008 - byte1
22000010 - byte16

array - dim, sizes[]

44000000 - array
44000001 - array[1]
44000002 - array[2]
44000003 - array[3]


44000003 - arr[3]
44000002 - arr[2]
11000004 - u32
00000006
00000008
00000003
00000004
00000005
00000004

45000000 - n-dimensional array

55000000 - tree

55000004 - tree rank 4
22000004 - component type id (e.g. u32)
00000009 - root
00000003 - root child 1
00000004
00000005
00000004


55000004 - tree rank 4
22000004 - component type id (e.g. u32)
00000009 - root
00000003 - root child 1
00000004
00000005
00000004



tuple - ids[]

ee000002
11000008
11000010
3
10


tuple(u32arr[2], u32arr[3])
ee000002 - tuple size 2
00000010
00000024
44000002 - arr[2]
11000020 - u32
6
7
44000003 - arr[3]
11000020 - u32
4
5
6
```

### None

`ee00000000000000`

Store def: `0xfffffffe000000051000000000`

```
00000005 - length
10000000 - sig
00       - steps count
```

### uint

Store def:
```
0xfffffffe0000000511000000030000000dee0000010000000522000001110000001d3333333800000000333333350000000200023333333000000003010003

00000005 - length
11000000 - sig
03       - steps count

0000000d - inputs length
ee000001
00000005
22000001
11

0000001d - steps length
33333338 - byte1 sig
00000000 - input indexes length
33333335 - contig
00000002 - input indexes length
00       - count/size
02       - byte1() result
33333330 - concat
00000003
01       - type_id header
00       - count/size
03       - contig result
```

Instantiate:

- `u32`:
```
0xffffffff11000000ee0000010000000711000003000004


ee000001 - tuple size 1
00000008 - end first tuple item
11000004 - u32
00000004 - value (size)

# result: 0xee000001000000081100000400000000

```
- `u256`: `0xffffffff11000000ee0000010000000711000003000020`
result: `0xee00000100000024110000200000000000000000000000000000000000000000000000000000000000000000`

### int

Store def:
```
0xfffffffe0000000512000000030000000dee0000010000000522000001120000001d3333333800000000333333350000000200023333333000000003010003

00000005 - length
12000000 - sig
03       - steps count

0000000d - inputs length
ee000001
00000005
22000001
12

0000001d - steps length
33333338 - byte1 sig
00000000 - input indexes length
33333335 - contig
00000002 - input indexes length
00       - count/size
02       - byte1() result
33333330 - concat
00000003
01       - type_id header
00       - count/size
03       - contig result
```

Instantiate:

- `u32`: `0xffffffff12000000ee0000010000000711000003000004`

## Composed

### Array

44000002 - arr[2]
11000004 - u32
content

Store def:
```
0xfffffffe0000000544000000040000000dee0000010000000522000001440000002833333337000000010133333335000000020003333333290000000103333333300000000402000504

00000005 - length
44000000 - sig
04       - steps count

0000000d - inputs length
ee000001
00000005
22000001 - 02 type_header
44

00000028
33333337 - dtnew (sig)
00000001 - input indexes length
01       - component type_id
33333335 - contig
00000002 - input indexes length
00       - array length
03       - new() result
33333329 - getTypeSignature
00000001
03       - new() result
33333330 - concat
00000004
02       - type_header
00       - array length
05       - dtnew signature
04       - contig result
```

Get data: `0xfffffffd44000000`

Instantiate: (e.g. `u32array4`)
```
0xffffffff44000000ee000002000000070000000f110000030000042200000411000004

44000000 - array sig

ee000002 - tuple size
00000007
0000000f
11000003
000004 - array length
22000004
11000004 - sig u
```
- result: `0xee00000100000018440000041100000400000000000000000000000000000000`

- `u32array6`: `0xffffffff44000000ee000002000000070000000f110000030000062200000411000004`. Result: `0xee000001000000204400000611000004000000000000000000000000000000000000000000000000`

- `u256array4`: `0xffffffff44000000ee000002000000070000000f110000030000042200000411000020`. Result: `0xee0000010000008844000004110000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`

Or shorthand: (by sized types)
- `0xffffffff4400000411000004`
- `0xffffffff4400000611000004`
- `0xffffffff4400000411000020`

### N-Dimensional Array

Store def:
```
0xfffffffe0000000545000000070000003cee000005000000050000000d000000150000001c000000242200000145220000043333333322000004333333301100000300000122000004220000040000004833333337000000020001333333310000000304020633333335000000020908333333290000000108333333280000000305070333333332000000020c0233333330000000030d0b0a

00000005 - length
45000000 - sig
07       - steps count

0000003c - inputs length
ee000005
00000005
0000000d
00000015
0000001c
00000024
22000001 - 03
45
22000004 - 04 - prod sig
33333333
22000004 - 05 - concat sig
33333330
11000003 - 06 - initial reduce value
000001
22000004 - 07 - signature type
22000004


00000048
33333337 - dtnew (sig)    - 08
00000002 - input indexes length
00       - component type_id
01       - component size
33333331 - reduce            - 09
00000003
04       - prod sig 33333333
02       - lengths array
06       - initial reduce value - 1
33333335 - contig         - 0a
00000002 - input indexes length
09       - reduce lengths prod
08       - new() result
33333329 - getTypeSignature  - 0b
00000001
08       - new() result
33333328 - curry         - 0c
00000003
05       - concat 33333330
07       - signature type
03       - type id - 45
33333332 - map            - 0d
00000002
0c       - vfsig curry
02       - lengths array
33333330 - concat         - 0e
00000003
0d       - curry map result
0b       - dtnew signature
0a       - contig result
```

E.g. `[[1, 2, 3, 4, 5], [6, 7, 8, 9, 10]]` - `u32[2][5]`

Inputs:

- component type id
- component size
- lengths array

```
0xffffffff45000000ee000003000000080000000f0000001d2200000411000000110000030000044400000211000003000002000005

45000000 - array sig

ee000003 - tuple size
00000008
0000000f
0000001d
22000004 - sig u
11000000
11000003 - u32 size
000004
44000002 - lengths array
11000003
000002
000005
```
- result: `0xee0000010000003445000002450000051100000400000000000000000000000000000000000000000000000000000000000000000000000000000000`


- e.g. `[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10, 11, 12]]` - `u32[4][3]`

`0xffffffff45000000ee000003000000080000000f0000001d2200000411000000110000030000044400000211000003000004000003`.
Result: `0xee0000010000003c450000044500000311000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`

## Union Type

`Union(selector:u32, Tuple) = T`


Store def: `0xfffffffe00000005666666660100000000000000093333333400000001ff`

```
00000005 - length
66666666 - sig
01       - steps count

00000000 - inputs

00000009
33333334 - identity
00000001
ff       - selected type value - e.g. 00000002 ; ff - ff -> take index 0
```

Instantiate call:  `0xffffffff66666666ee000005000000080000001000000018000000200000002822000004000000021100000455555555110000048888888811000004777777771100000444444444`

```
ee000005
00000008  - length for selector
00000010  - tuple elem 1
00000018
00000020
00000028
22000004 - selector value
00000002
11000004 - tuple item 1
55555555
11000004 - tuple item 2
88888888
11000004 - tuple item 3
77777777
11000004 - tuple item 4
44444444
```

## Tree

One level tree: `Tree(rank:u8, T) = Concat(T, Contig(rank, None))`

Input:
- rank
-

Store def:
```
0xfffffffe0000000511000000030000000dee0000010000000522000001110000001d3333333800000000333333350000000200023333333000000003010003

00000005 - length
55000000 - sig
04       - steps count

0000000d - inputs length
ee000001
00000005
22000001
11

0000001d - steps length
33333338 - byte1 sig
00000000 - input indexes length
33333335 - contig
00000002 - input indexes length
00       - count/size
02       - byte1() result
33333330 - concat
00000003
01       - type_id header
00       - count/size
03       - contig result
```


`Tree(rank:u32, T) = Concat(T, Contig(rank, Union(None, Tree(rank, T))))`


Tree(rank:u8, T) = Concat(T, non_none:u32, Contig(rank, Union(None, Tree(rank, T))))

Tree(rank:u8, T) = Concat(T, Contig(rank, None))

Tree(rank:u8, T, Tuple) = Concat(T, Tuple)

arrity(Tuple) = rank
Tuple  = contig(rank, )

- None, T, Tree(rank, T)

## Linked List

LinkedList(T) = concat(T, next: Union(None, LinkedList(T)))


## Casting

E.g. u32 -> u256: `0xffffffff3333331cee000002000000080000001022000004110000201100000400000001`

```
0x3333331c
ee000002
00000008
00000010
22000004 - to type
11000020
11000004 - from typed value
00000001
```

- result `0xee00000100000024110000200000000000000000000000000000000000000000000000000000000000000001`

- u24 -> u128: `0xffffffff3333331cee0000020000000800000010220000041100001011000003000008`. Result `0xee000001000000141100001000000000000000000000000000000008`

- byte4 -> byte32: `0xffffffff3333331cee000002000000080000001022000004220000202200000433333333`. Result `0xee00000100000024220000203333333300000000000000000000000000000000000000000000000000000000`

- byte3 -> byte16: `0xffffffff3333331cee0000020000000800000010220000042200001022000003444444`. Result `0xee000001000000142200001044444400000000000000000000000000`

- u32 -> i256: `0xffffffff3333331cee000002000000080000001022000004120000201100000400000001`. Result `0xee00000100000024120000200000000000000000000000000000000000000000000000000000000000000001`

- i32 -> u256: `0xffffffff3333331cee000002000000080000001022000004110000201200000400000001`. Result `0xee00000100000024110000200000000000000000000000000000000000000000000000000000000000000001`

- i32 -> u256: `0xffffffff3333331cee0000020000000800000010220000041100002012000004ffffffff`. Result `revert`

- u256 -> i32: `0xffffffff3333331cee000002000000080000002c2200000412000004110000200000000000000000000000000000000000000000000000000000000000000001`. Result `0xee000001000000081200000400000001`

- u256 -> i8: `0xffffffff3333331cee000002000000080000002c2200000412000001110000200000000000000000000000000000000000000000000000000000000000000001`. Result `0xee000001000000051200000101`

- u256 -> i8: `0xffffffff3333331cee000002000000080000002c220000041200000111000020000000000000000000000000000000000000000000000000000000000000007f`. Result `0xee00000100000005120000017f`

- u256 -> i8: `0xffffffff3333331cee000002000000080000002c2200000412000001110000200000000000000000000000000000000000000000000000000000000000000080`. Result `revert`

- u256 -> i16: `0xffffffff3333331cee000002000000080000002c2200000412000002110000200000000000000000000000000000000000000000000000000000000000007f00`. Result `0xee00000100000006120000027f00`

- u256 -> i16: `0xffffffff3333331cee000002000000080000002c2200000412000002110000200000000000000000000000000000000000000000000000000000000000008000`. Result `revert`

- i8 -> i16: `0xffffffff3333331cee000002000000080000000d220000041200000212000001fa`. Result `0xee0000010000000612000002fffa`

### Casting Arrays

#### 1)

```

0xfffffffe00000005777777770200000010ee00000100000008220000043333331c000000143333333700000001003333331b00000003020301

00000005 - length
77777777 - sig
02       - steps count

00000010 - inputs length
ee000001
00000008
22000004 - 02 - cast sig
3333331c

00000014
33333337 - new array
00000001
00       - to_type (array sig)
3333331b - zip_apply
00000003
02       - cast sig
03       - new array
01       - initial array
```

- `0xffffffff77777777ee0000020000000c000000202200000844000003110000044400000312000004000000020000000500000004` -> `0xee000001000000144400000311000004000000020000000500000004`
- `0xffffffff77777777ee0000020000000c000000202200000844000003110000084400000312000004000000020000000500000004` -> `0xee000001000000204400000311000008000000000000000200000000000000050000000000000004`


#### 2)

Input:
- new array type
- array

```
0xfffffffe00000005777777880300000026ee000003000000070000000e000000161100000300000411000003000002220000043333331c0000001f3333331a000000030203003333332800000002040533333332000000020601

00000005 - length
77777788 - sig
03       - steps count

00000026 - inputs
ee000003
00000007
0000000e
00000016
11000003 - slice_size - 02
000004
11000003 - index - 03
000002
22000004 - cast sig - 04
3333331c

0000001f
3333331a - selectraw
00000003
02       - slice_size
03       - index
00       - to_type
33333328 - curry
00000002
04       - cast sig
05       - selectraw
33333332 - map
00000002
06       - curry sig
01       - array from
```

- `0xffffffff77777777ee0000020000000c000000202200000844000003110000044400000312000004000000020000000500000004` -> `0xee000001000000144400000311000004000000020000000500000004`

## Sized Types

Devs do not need to store every type size, only the abstract type definition (`new` function).
E.g. for uint `0x11000000`, we only store the above `uint` definition. Then, we can use `0x11000004` for representing `u32`.

`0xffffffff11000008` will result in `0xee0000010000000c120000080000000000000000`

## Named Types

Store def: `0xfffffffc88ffffffee000002000000040000001311000000ee0000010000000711000003000020`
```
88ffffff - named type id

ee0000020000000400000013
11000000 - abstract type id
ee000001 - input for new(abstract_type_id(<input>))
00000007
11000003 - for u32, the input is the size
000020
```
Use: `0xffffffff88ffffff`. Result: `0xee00000100000024110000200000000000000000000000000000000000000000000000000000000000000000`


## Native Functions

- byte1, new, identity, contig, concat
- sum, sub, div, prod
- map, reduce, curry
- cast
- getTypeSignature
- insert, get, count, log typed values per type
- sendPay

### Reduce

E.g. `[2, 5].reduce(prod, 1)`

`0xffffffff33333331ee00000300000008000000160000001d2200000433333333440000021100000300000200000511000003000001`

```
33333331 - reduce            - 08
00000003
04       - prod sig 33333333
02       - lengths array
06       - initial reduce value - 1

ee000003
00000008
00000016
0000001d
22000004 - sig
33333333
44000002 - lengths array
11000003
000002
000005
11000003 - initial value
000001
```

Result: `0xee000001000000071100000300000a` -> `10`

### curry

E.g. `[0x000003, 0x000002].map(concat(0x44))` -> `[0x44000003, 0x44000002]`

`0xfffffffe0000000566000000020000000000000015333333280000000300010233333332000000020403`

```
00000005 - length
66000000 - sig
02       - steps count

00000000 - inputs length

00000015
33333328 - curry
00000003
00       - concat 33333330
01       - final element id
02       - typeid index
33333332 - map
00000002
04       - vfsig curry
03       - array
```
Execute: `0xffffffff66000000ee000004000000080000001000000015000000262200000433333330220000042200000422000001444400000311000003000003000002000005`

```
ee000004
00000008
00000010
00000015
00000026
22000004 - concat sig
33333330
22000004 - final array element id
22000004
22000001 - typeid index
44
44000003 - array
11000003
000003
000002
000005
```
Result: `0xee000001000000144400000300000004440000034400000244000005` -> tuple with the array result. Note: array item id is unknown: `00000004`, but its size is known (`concat` does not assign a typeid, it just concatenates what it is given)

### Special Functions

- insert typed value: `0xffffffff33333326ee0000010000000722000003777777`
- get typed value: `0xffffffff33333325ee000002000000080000001022000004220000031100000400000001` -> `0xee0000010000000722000003777777`
- count values per type: `0xffffffff33333324ee000001000000081100000422000003`

- send pay: `0xffffffff33333321ee000002000000180000003c11000014D32298893dD95c1Aaed8A79bc06018b8C265a279110000200000000000000000000000000000000000000000000000000de0b6b3a7640000`

de0b6b3a7640000
100000000000000
0000


Input:
- percentage to address2
- address1

User input:
- address2
- value

```
0xfffffffe0000000577777777050000002cee0000020000000800000020110000040000003211000014D32298893dD95c1Aaed8A79bc06018b8C265a279000000323333331d0000000201023333331e000000020104333333210000000203043333332100000002000533333334000000020607

00000005 - length
77777777 - sig
05       - steps count

0000002c - inputs length
ee000002
00000008
00000020
11000004 - percentage - 02
00000032
11000014 - address1  - 03
D32298893dD95c1Aaed8A79bc06018b8C265a279

00000032 - steps length
3333331d - dtdiv - to address1 - 04
00000002
01
02
3333331e - sub - to address 2 - 05
00000002
01
04
33333321 - pay address 1 - 06
00000002
03
04
33333321 - pay address 2 - 07
00000002
00
05
33333334 - identity - 08
00000002
06
07
```

Execute: `0xffffffff77777777ee000002000000180000003c11000014fffFd05c2b12cfE3c74464531f88349e159785ea110000200000000000000000000000000000000000000000000000000de0b6b3a7640000`

## Runtime Functions

### Integer Casting

Store def:
```
0xfffffffe0000000511000000030000000dee0000010000000522000001110000001d3333333800000000333333350000000200023333333000000003010003

00000005 - length
11000000 - sig
03       - steps count

0000000d - inputs length
ee000001
00000005
22000001
11

0000001d - steps length
33333338 - byte1 sig
00000000 - input indexes length
33333335 - contig
00000002 - input indexes length
00       - count/size
02       - byte1() result
33333330 - concat
00000003
01       - type_id header
00       - count/size
03       - contig result
```

Instantiate:

- `u32`:
```
0xffffffff11000000ee0000010000000711000003000004


ee000001 - tuple size 1
00000008 - end first tuple item
11000004 - u32
00000004 - value (size)

# result: 0xee000001000000081100000411111111

```
